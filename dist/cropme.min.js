/*!
 * cropme v1.4.2
 * https://shpontex.github.io/cropme
 *
 * Copyright 2019 shpontex
 * Released under the MIT license
 *
 * Date: 2019-12-11T09:35:56.508Z
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).Cropme=t()}(this,function(){"use strict";function Z(e){return(Z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function p(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function a(e){return e&&"object"===Z(e)&&!Array.isArray(e)}function h(e){for(var t=arguments.length,i=new Array(1<t?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];if(!i.length)return e;var o,n=i.shift();if(Object.assign||Object.defineProperty(Object,"assign",{enumerable:!1,configurable:!0,writable:!0,value:function(e){if(null==e)throw new TypeError("Cannot convert first argument to object");for(var t=Object(e),i=1;i<arguments.length;i++){var r=arguments[i];if(null!=r){r=Object(r);for(var o=Object.keys(Object(r)),n=0,s=o.length;n<s;n++){var p=o[n],a=Object.getOwnPropertyDescriptor(r,p);void 0!==a&&a.enumerable&&(t[p]=r[p])}}}return t}}),a(e)&&a(n))for(var s in n)a(n[s])?(e[s]||Object.assign(e,p({},s,{})),h(e[s],n[s])):(o=n[s])&&Array.isArray(o)?(e[s]||Object.assign(e,p({},s,[])),e[s]=e[s].concat(n[s])):Object.assign(e,p({},s,n[s]));return h.apply(void 0,[e].concat(i))}function w(){return"translate3d("+this.properties.x+"px,"+this.properties.y+"px, 0) scale("+this.properties.scale+") rotate("+this.properties.deg+"deg)"}function f(e,t){return e+"px "+t+"px"}function l(){if(this.properties.rotation_slider)this.options.rotation.slider?this.properties.rotation_slider.disabled=!this.options.rotation.enable:(this.properties.wrapper.removeChild(this.properties.rotation_slider.parentNode),delete this.properties.rotation_slider),this.properties.rotation_slider&&(this.properties.rotation_slider.style.width=this.properties.container.offsetWidth+"px");else if(this.options.rotation.slider){var e=document.createElement("div");e.classList.add("cropme-rotation-slider");var t=this.properties.rotation_slider=document.createElement("input");t.type="range",t.setAttribute("min",-180),t.setAttribute("max",180),t.setAttribute("step",1),t.value=0,t.style.width=this.properties.container.offsetWidth+"px",e.appendChild(t),this.properties.wrapper.appendChild(e);var i=this;this.properties.rotation_slider.addEventListener(n()?"change":"input",function(e){i.rotate(e.target.value)}),this.properties.rotation_slider.disabled=!this.options.rotation.enable}}function n(){var e=window.navigator.userAgent,t=e.indexOf("MSIE ");if(0<t)return parseInt(e.substring(t+5,e.indexOf(".",t)),10);if(0<e.indexOf("Trident/")){var i=e.indexOf("rv:");return parseInt(e.substring(i+3,e.indexOf(".",i)),10)}var r=e.indexOf("Edge/");return 0<r&&parseInt(e.substring(r+5,e.indexOf(".",r)),10)}function u(){function e(){var e=(this.properties.wrapper.offsetWidth-this.properties.container.offsetWidth)/2,t=this.properties.container.offsetWidth/2+12+e;"left"===this.options.rotation.position&&(t=-this.properties.container.offsetWidth/2-20+e);var i=(this.properties.container.offsetWidth-this.properties.container.offsetHeight)/2,r=this.properties.container.offsetHeight/2+12-i;this.properties.sliderContainer.style.transform="translate3d("+t+"px, "+r+"px, 0) rotate(-90deg)";var o=this.properties.container.offsetWidth/2;this.properties.sliderContainer.style.transformOrigin=o+"px 12px",this.properties.sliderContainer.style.marginTop="-24px",this.properties.slider.disabled=!this.options.zoom.enable}if(this.properties.slider)this.options.zoom.slider?e.call(this):(this.properties.wrapper.removeChild(this.properties.slider.parentNode),delete this.properties.slider);else if(this.options.zoom.slider){var t=this,i=this.properties.sliderContainer=document.createElement("div");i.classList.add("cropme-slider");var r=this.properties.slider=document.createElement("input");r.type="range",r.setAttribute("min",this.options.zoom.min),r.setAttribute("max",this.options.zoom.max),r.setAttribute("step",1e-6),r.style.width=this.properties.container.offsetHeight+"px",i.style.width=this.properties.container.offsetHeight+"px",i.appendChild(r),this.properties.wrapper.insertBefore(i,this.properties.wrapper.firstChild),this.properties.slider.value=this.properties.scale,this.properties.slider.addEventListener(n()?"change":"input",function(e){t.properties.scale=parseFloat(e.target.value),t.properties.image.style.transform=w.call(t)}),e.call(this)}}function d(){var e=this.properties.container;e||(e=this.properties.container=document.createElement("div"),this.properties.wrapper.appendChild(e)),e.classList.add("cropme-container"),e.style.width=this.options.container.width+("string"==typeof this.options.container.width?"":"px"),e.style.height=this.options.container.height+"px"}function m(){var e=this.properties.viewport=this.properties.viewport||document.createElement("div"),t=this.properties.container,i=this.options,r=i.viewport.border.width;if(t.style.width=i.viewport.width>t.offsetWidth?i.viewport.width+2*r+"px":t.offsetWidth,t.style.height=i.viewport.height>t.offsetHeight?i.viewport.height+2*r+"px":t.offsetHeight,e.style.width=i.viewport.width+"px",e.style.height=i.viewport.height+"px",e.className="viewport","circle"===i.viewport.type&&(e.className="viewport circle"),i.viewport.border.enable){var o=(t.offsetWidth-i.viewport.width)/2;i.viewport.border.width=o<i.viewport.border.width?o:i.viewport.border.width}else i.viewport.border.width=0;this.properties.viewport.style.borderWidth=i.viewport.border.width+"px",this.properties.viewport.style.borderColor=i.viewport.border.color,this.properties.container.appendChild(e)}function g(){var e=this.properties.image.style.transformOrigin.split("px ");return{x:parseFloat(e[0]),y:parseFloat(e[1])}}function v(){var e=g.call(this),t=e.x,i=e.y,r=-parseInt(this.properties.deg)*Math.PI/180;if("viewport"===this.options.transformOrigin){var o=this.properties.deg;this.properties.deg=0,this.properties.image.style.transform=w.call(this);var n,s,p=this.properties.scale,a=this.properties.container,h=this.properties.image.getBoundingClientRect(),c=this.properties.viewport.getBoundingClientRect(),l=c.top-h.top+c.height/2,u=(c.left-h.left+c.width/2)/p-t,d=l/p-i;n=t+(u*Math.cos(r)-d*Math.sin(r)),s=i+(u*Math.sin(r)+d*Math.cos(r)),this.properties.x=a.offsetWidth/2-n,this.properties.y=a.offsetHeight/2-s,this.properties.image.style.transformOrigin=f.call(this,n,s),this.properties.deg=o,this.properties.image.style.transform=w.call(this)}else this.properties.x-=this.properties.origin_x-t,this.properties.y-=this.properties.origin_y-i,this.properties.image.style.transformOrigin=f.call(this,this.properties.origin_x,this.properties.origin_y),this.properties.image.style.transform=w.call(this)}function s(){d.call(this),l.call(this),u.call(this),function(){this.properties.image||(this.properties.image=new Image),this.properties.image.ondragstart=function(){return!1},this.properties.container.appendChild(this.properties.image)}.call(this),m.call(this);function e(e){e.preventDefault();var t=e.pageX,i=e.pageY;e.touches&&(t=e.touches[0].pageX,i=e.touches[0].pageY),r=c.properties.x||r,o=c.properties.y||o,a=t-r,h=i-o,document.addEventListener("mousemove",n),document.addEventListener("touchmove",n),document.addEventListener("mouseup",s),document.addEventListener("touchend",s)}var a,h,r=0,o=0,c=this;c.properties.image.addEventListener("mousedown",e),c.properties.image.addEventListener("touchstart",e);var n=function(e){e.preventDefault();var t=e.pageX,i=e.pageY;if(e.touches&&(t=e.touches[0].pageX,i=e.touches[0].pageY),e.touches&&1<e.touches.length){var r=e.touches[1],o=t-r.pageX,n=i-r.pageY;if(c.options.rotation.enable){var s=90-180*Math.atan2(o,n)/Math.PI;c.properties.odeg||(c.properties.odeg=s-c.properties.deg),c.properties.deg=s-c.properties.odeg}if(c.options.zoom.enable){var p=Math.sqrt(Math.pow(o,2)+Math.pow(n,2));c.properties.od||(c.properties.od=p/c.properties.scale),c.properties.scale=p/c.properties.od,c.properties.slider&&(c.properties.slider.value=c.properties.scale)}}else c.properties.x=t-a,c.properties.y=i-h;c.properties.image.style.transform=w.call(c)},s=function e(){document.removeEventListener("touchmove",n),document.removeEventListener("mousemove",n),document.removeEventListener("mouseup",e),document.removeEventListener("touchend",e),c.properties.od=0,c.properties.odeg=0,v.call(c)};c.properties.container.addEventListener("mousewheel",function(e){e.preventDefault();var t=c.properties.scale+e.wheelDelta/1200*c.properties.scale;t>c.options.zoom.min&&t<c.options.zoom.max&&c.options.zoom.mouseWheel&&c.options.zoom.enable&&(c.options.zoom.slider&&(c.properties.slider.value=t),c.properties.scale=t,c.properties.image.style.transform=w.call(c))})}(function(K){function r(e){if(o[e])return o[e].exports;var t=o[e]={i:e,l:!1,exports:{}};return i[e].call(t.exports,t,t.exports,r),t.l=!0,t.exports}var i,o;o={},r.m=i={100:function(e,t,i){(function(e){var t=i(5);try{e.Promise=t,window.Promise=t}catch(e){}}).call(t,i(2))},2:function(e){var t;t=function(){return this}();try{t=t||Function("return this")()||(0,eval)("this")}catch(e){"object"==("undefined"==typeof window?"undefined":Z(window))&&(t=window)}e.exports=t},5:function(J,e,t){(function(G){!function(){function r(){return $[F][H]||"Symbol(species)"}function o(e){return e&&"object"==Z(e)}function a(e){return"function"==typeof e}function h(e,t){return e instanceof t}function t(e,t,i){if(!t(e))throw l(i)}function i(){try{return j.apply(O,arguments)}catch(e){return X.e=e,X}}function c(e,t){return j=e,O=t,i}function e(t,i){function r(){for(var e=0;e<n;)i(o[e],o[e+1]),o[e++]=_,o[e++]=_;n=0,o.length>t&&(o.length=t)}var o=P(t),n=0;return function(e,t){o[n++]=e,o[n++]=t,2===n&&$.nextTick(r)}}function p(e,t){var i,r,o,n,s=0;if(!e)throw l(B);var p=e[$[F].iterator];if(a(p))r=p.call(e);else{if(!a(e.next)){if(h(e,P)){for(i=e.length;s<i;)t(e[s],s++);return s}throw l(B)}r=e}for(;!(o=r.next()).done;)if((n=c(t)(o.value,s++))===X)throw a(r.return)&&r.return(),n.e;return s}function l(e){return new TypeError(e)}function n(e){return(e?"":D)+(new M).stack}function s(e,t){var i="on"+e.toLowerCase(),r=z[i];k&&k.listeners(e).length?e===U?k.emit(e,t._v,t):k.emit(e,t):r?r({reason:t._v,promise:t}):$[e](t._v,t)}function u(e){return e&&e._s}function d(e){return u(e)?new e(x):(i=new e(function(e,t){if(i)throw l();r=e,o=t}),t(r,a),t(o,a),i);var i,r,o}function f(t,i){var r=!1;return function(e){r||(r=!0,W&&(t[N]=n(!0)),i===S?w(t,e):v(t,i,e))}}function m(e,t){function i(e){return r.push(e.replace(/^\s+|\s+$/g,""))}var r=[];return W&&(t[N]&&i(t[N]),function e(t){t&&T in t&&(e(t._next),i(t[T]+""),e(t._p))}(t)),(e&&e.stack?e.stack:e)+("\n"+r.join("\n")).replace(q,"")}function g(e,t){return e(t)}function v(e,t,i){var r=0,o=e._c;if(e._s===A)for(e._s=t,e._v=i,t===R&&(W&&h(i,M)&&(i.longStack=m(i,e)),V(e));r<o;)Q(e,e[r++]);return e}function w(e,t){if(t===e&&t)return v(e,R,l(Y)),e;if(t!==C&&(a(t)||o(t))){var i=c(y)(t);if(i===X)return v(e,R,i.e),e;a(i)?(W&&u(t)&&(e._next=t),u(t)?b(e,t,i):$.nextTick(function(){b(e,t,i)})):v(e,S,t)}else v(e,S,t);return e}function y(e){return e.then}function b(t,i,e){var r=c(e,i)(function(e){i&&(i=C,w(t,e))},function(e){i&&(i=C,v(t,R,e))});r===X&&i&&(v(t,R,r.e),i=C)}function x(){}var _,j,O,C=null,E="object"==("undefined"==typeof self?"undefined":Z(self)),z=E?self:G,L=z.Promise,k=z.process,I=z.console,W=!1,P=Array,M=Error,R=1,S=2,A=3,F="Symbol",H="species",T="_pt",N="_st",B="Invalid argument",D="\nFrom previous ",Y="Chaining cycle detected for promise",U="unhandledRejection",X={e:C},q=/^.+\/node_modules\/yaku\/.+\n?/gm,$=function(e){var t,i=this;if(!o(i)||i._s!==_)throw l("Invalid this");if(i._s=A,W&&(i[T]=n()),e!==x){if(!a(e))throw l(B);(t=c(e)(f(i,S),f(i,R)))===X&&v(i,R,t.e)}};(function(e,t){for(var i in t)e[i]=t[i]})(($.default=$).prototype,{then:function(e,t){if(this._s===K)throw l();return i=this,r=d($.speciesConstructor(this,$)),n=t,a(o=e)&&(r._onFulfilled=o),a(n)&&(i._uh&&s("rejectionHandled",i),r._onRejected=n),W&&(r._p=i),i[i._c++]=r,i._s!==A&&Q(i,r),r;var i,r,o,n},catch:function(e){return this.then(_,e)},finally:function(t){return this.then(function(e){return $.resolve(t()).then(function(){return e})},function(e){return $.resolve(t()).then(function(){throw e})})},_c:0,_p:C}),$.resolve=function(e){return u(e)?e:w(d(this),e)},$.reject=function(e){return v(d(this),R,e)},$.race=function(e){function t(e){v(o,S,e)}function i(e){v(o,R,e)}var r=this,o=d(r),n=c(p)(e,function(e){r.resolve(e).then(t,i)});return n===X?r.reject(n.e):o},$.all=function(e){function i(e){v(n,R,e)}var r,o=this,n=d(o),s=[];return(r=c(p)(e,function(e,t){o.resolve(e).then(function(e){s[t]=e,--r||v(n,S,s)},i)}))===X?o.reject(r.e):(r||v(n,S,[]),n)},$.Symbol=z[F]||{},c(function(){Object.defineProperty($,r(),{get:function(){return this}})})(),$.speciesConstructor=function(e,t){var i=e.constructor;return i&&i[r()]||t},$.unhandledRejection=function(e,t){I&&I.error("Uncaught (in promise)",W?t.longStack:m(e,t))},$.rejectionHandled=x,$.enableLongStackTrace=function(){W=!0},$.nextTick=E?function(e){L?new L(function(e){e()}).then(e):setTimeout(e)}:k.nextTick,$._s=1;var Q=e(999,function(e,t){var i,r;return(r=e._s!==R?t._onFulfilled:t._onRejected)===_?void v(t,e._s,e._v):(i=c(g)(r,e._v))===X?void v(t,R,i.e):void w(t,i)}),V=e(9,function(e){!function e(t){if(t._umark)return!0;t._umark=!0;for(var i,r=0,o=t._c;r<o;)if((i=t[r++])._onRejected||e(i))return!0}(e)&&(e._uh=1,s(U,e))});try{J.exports=$}catch(e){z.Yaku=$}}()}).call(e,t(2))}},r.c=o,r.i=function(e){return e},r.d=function(e,t,i){r.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:i})},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=100)}).call("object"===("undefined"==typeof window?"undefined":Z(window))&&window||"object"===("undefined"==typeof self?"undefined":Z(self))&&self||"object"===("undefined"==typeof global?"undefined":Z(global))&&global||{}),window.jQuery&&(jQuery.fn.cropme=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=1<arguments.length?arguments[1]:void 0;if("object"===Z(t))return this.each(function(){var e=new r(this,t);$(this).data("cropme",e)});if("string"!=typeof t)throw"Error: the argument must be an object or a string";var i=$(this).data("cropme");switch(t){case"position":return i.position();case"bind":return i.bind(e);case"crop":return i.crop(e);case"rotate":return i.rotate(e);case"reload":return i.reload(e);case"destroy":return i.destroy();default:throw"Error: "+t+" method not found"}});var r=function(){function i(e,t){if(!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),-1<e.className.indexOf("cropme-wrapper"))throw"Error: Cropme is already initialized";if(this.properties={},this.options=h(c,t),this.options.viewport.width>this.options.container.width)throw"Error: Viewport width cannot be greater that container width";if(this.options.viewport.height>this.options.container.height)throw"Error: Viewport height cannot be greater that container height";"img"===(this.properties.wrapper=e).tagName.toLowerCase()&&(this.properties.image=new Image,this.properties.image.src=e.src,this.properties.wrapper=document.createElement("div"),e.parentNode.insertBefore(this.properties.wrapper,e.previousSibling),e.parentNode.removeChild(e)),this.properties.wrapper.className+=" cropme-wrapper "+this.options.customClass,s.call(this),this.properties.image.src&&this.bind({url:this.properties.image.src})}var e,t,r;return e=i,(t=[{key:"resize",value:function(){var e=this.properties.container,t=this.properties.container_w-e.offsetWidth,i=this.properties.container_h-e.offsetHeight;e.style.width=this.options.container.width+("string"==typeof this.options.container.width?"":"px"),e.offsetWidth>this.options.viewport.width?(this.properties.x-=t/2,this.properties.y-=i/2,this.properties.container_w=e.offsetWidth,this.properties.container_h=e.offsetHeight,this.properties.ox-=t/2,this.properties.oy-=i/2,this.properties.image.style.transform=w.call(this),u.call(this),l.call(this)):e.style.width=this.options.viewport.width+2*this.options.viewport.border.width+"px"}},{key:"bind",value:function(a){var e=this;window.onresize=this.resize.bind(this),this.properties.image.src=a.url;var h=this.properties,c=this.options,l=this;return new Promise(function(p){e.properties.image.onload=function(){var e=h.image.getBoundingClientRect(),t=h.container.getBoundingClientRect(),i=(t.width-e.width)/2,r=(t.height-e.height)/2,o=t.height/e.height,n=0;h.ox=i,h.oy=r;var s={};if("object"===Z(a.position)&&(i=a.position.x?a.position.x+i:i,r=a.position.y?a.position.y+r:r,o=a.position.scale||o,n=a.position.angle||n,s=a.position.origin||s,c.transformOrigin="object"===a.position.origin?"viewport":"image"),c.zoom.max<=c.zoom.min)throw"Error: max zoom cannot be less or equal to min zoom";o<c.zoom.min&&(o=c.zoom.min),o>c.zoom.max&&(o=c.zoom.max),h.x=i,h.y=r,h.container_w=t.width,h.container_h=t.height,h.origin_x=e.width/2,h.origin_y=e.height/2,h.scale=o,l.options.zoom.slider&&(h.slider.value=o),l.options.rotation.slider&&(h.rotation_slider.value=n),h.deg=n,h.image.style.transform=w.call(l),h.image.style.transformOrigin=f.call(l,s.x||h.origin_x,s.y||h.origin_y),h.image.style.opacity=1,v.call(l),p(l.properties.image)}})}},{key:"rotate",value:function(e){this.properties.deg=e;var t=this.properties.image.style.transformOrigin.split("px "),i=parseInt(t[0]),r=parseInt(t[1]);this.properties.rotate_originx=i,this.properties.rotate_originy=r,this.properties.image.style.transform=w.call(this)}},{key:"crop",value:function(e){var i=function(e){var t=document.createElement("canvas"),i=t.getContext("2d"),r=this.options.viewport.width,o=this.options.viewport.height;"object"===Z(e)&&(e.scale?(r*=e.scale,o*=e.scale):e.width&&(o=e.width*o/r,r=e.width)),t.width=r,t.height=o;var n=r/this.options.viewport.width,s=o/this.options.viewport.height,p=this.properties.deg,a=this.properties.x,h=this.properties.y;function c(e,t,i){this.properties.deg=e,this.properties.x=t,this.properties.y=i,this.properties.image.style.transform=w.call(this)}c.call(this,0,this.properties.ox,this.properties.oy);var l=this.properties.image.getBoundingClientRect(),u=this.properties.viewport.getBoundingClientRect(),d=n*(l.left-u.left-this.options.viewport.border.width),f=s*(l.top-u.top-this.options.viewport.border.width),m=this.options.transformOrigin,g=(a-this.properties.x)*n,v=(h-this.properties.y)*s;return"image"===m&&i.translate(g,v),i.translate(r/2,o/2),i.rotate(p*Math.PI/180),"image"===m?i.translate(-r/2,-o/2):i.translate(-r/2+g,-o/2+v),i.imageSmoothingEnabled=!1,i.drawImage(this.properties.image,d,f,l.width*n,l.height*s),"circle"===this.options.viewport.type&&("image"===m?i.translate(r/2,o/2):i.translate(r/2-g,o/2-v),i.rotate(-p*Math.PI/180),i.translate(-r/2,-o/2),i.scale(1,this.options.viewport.height/this.options.viewport.width),"image"===m?i.translate(2*-g,2*-v):i.translate(-g,-v),i.globalCompositeOperation="destination-in",i.arc(r/2+g,o/2+v,r/2,0,2*Math.PI),i.fill()),c.call(this,p,a,h),t}.call(this,e),r="object"===Z(e)?e.type:e;return new Promise(function(t){"blob"===r?i.toBlob(function(e){return t(URL.createObjectURL(e))},e.mimetype,e.quality):"object"===Z(e)?t(i.toDataURL(e.mimetype,e.quality)):t(i.toDataURL())})}},{key:"position",value:function(){var e={x:parseFloat((this.properties.x-this.properties.ox).toFixed(3)),y:parseFloat((this.properties.y-this.properties.oy).toFixed(3)),scale:parseFloat(this.properties.scale.toFixed(4)),angle:parseInt(this.properties.deg)};return"viewport"===this.options.transformOrigin&&(e.origin=g.call(this)),e}},{key:"reload",value:function(e){this.options=h(c,e),u.call(this),d.call(this),l.call(this),m.call(this),v.call(this)}},{key:"destroy",value:function(){this.properties.wrapper.innerHTML="",this.properties.wrapper.className=this.properties.wrapper.className.replace("cropme-wrapper",""),delete this.options,delete this.properties}}])&&o(e.prototype,t),r&&o(e,r),i}(),c={container:{width:300,height:300},viewport:{width:100,height:100,border:{enable:!0,width:2,color:"#fff"}},transformOrigin:"viewport",zoom:{min:.01,max:3,enable:!0,mouseWheel:!0,slider:!1},customClass:"",rotation:{slider:!1,enable:!0,position:"right"}};return r});